// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    // NOTE: When using mysql or sqlserver, uncomment the @db.Text annotations in model Account below
    // Further reading:
    // https://next-auth.js.org/adapters/prisma#create-the-prisma-schema
    // https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#string
    url      = env("DATABASE_URL")
}

// Photography Core Models

model Client {
  id        String   @id @default(cuid())
  name      String
  email     String?  @unique
  phone     String?
  address   String?  // Client's main address
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  locations Location[]
  shoots    Shoot[]

  @@index([name])
}

model ShootType {
    id          String   @id @default(cuid())
    name        String   @unique
    code        String   @unique // RE, DR, EV, VT, PC
    description String?
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    shoots      Shoot[]

    @@index([name])
    @@index([code])
}

model Location {
  id          String   @id @default(cuid())
  name        String
  address     String?
  city        String?
  state       String?
  country     String?
  coordinates String? // For storing lat/lng
  clientId    String? // Link to client (optional for backward compatibility)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  client      Client?  @relation(fields: [clientId], references: [id], onDelete: Cascade)
  shoots      Shoot[]

  @@unique([name, clientId]) // Unique name per client
  @@index([city])
  @@index([clientId])
}

model Photographer {
    id          String   @id @default(cuid())
    name        String
    email       String?  @unique
    phone       String?
    specialties String[] // Array of expertise areas
    rating      Float?   @default(0)
    isActive    Boolean  @default(true)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    shootPhotographers ShootPhotographer[]

    @@index([name])
    @@index([isActive])
}

model Editor {
    id          String   @id @default(cuid())
    name        String
    email       String?  @unique
    phone       String?
    specialties String[] // Array of expertise areas
    rating      Float?   @default(0)
    isActive    Boolean  @default(true)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    shootEditors ShootEditor[]

    @@index([name])
    @@index([isActive])
}

model Shoot {
    id                    String   @id @default(cuid())
    shootId               String   @unique // Custom shoot ID (e.g., RE-2024-001), editable by admin
    clientId              String
    shootTypeId           String
    locationId            String?
    projectName           String?  // User-defined project name
    remarks               String?  // Free text remarks
    editId                String?  // Per deliverable basis linked to shoot ID
    overallDeliverables   String?
    shootStartDate        DateTime?
    shootEndDate          DateTime?
    photographerNotes     String?
    editorNotes           String?
    // Cost tracking fields
    photographyCost       Float?   // Shoot cost
    travelCost            Float?   // Travel cost (separate from photography)
    editingCost           Float?   // Editing cost
    status                String   @default("planned") // planned, in_progress, completed, cancelled
    createdAt             DateTime @default(now())
    updatedAt             DateTime @updatedAt

    client                Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
    shootType             ShootType @relation(fields: [shootTypeId], references: [id])
    location              Location? @relation(fields: [locationId], references: [id])
    
    shootPhotographers    ShootPhotographer[]
    shootEditors          ShootEditor[]

    @@index([shootId])
    @@index([clientId])
    @@index([shootTypeId])
    @@index([status])
    @@index([shootStartDate])
    @@index([projectName])
}

// Junction table for many-to-many relationship between shoots and photographers
model ShootPhotographer {
    id             String       @id @default(cuid())
    shootId        String
    photographerId String
    role           String?      // Lead, Assistant, etc.
    assignedAt     DateTime     @default(now())

    shoot          Shoot        @relation(fields: [shootId], references: [id], onDelete: Cascade)
    photographer   Photographer @relation(fields: [photographerId], references: [id], onDelete: Cascade)

    @@unique([shootId, photographerId])
    @@index([shootId])
    @@index([photographerId])
}

// Junction table for many-to-many relationship between shoots and editors
model ShootEditor {
    id        String   @id @default(cuid())
    shootId   String
    editorId  String
    role      String?  // Lead, Assistant, etc.
    assignedAt DateTime @default(now())

    shoot     Shoot    @relation(fields: [shootId], references: [id], onDelete: Cascade)
    editor    Editor   @relation(fields: [editorId], references: [id], onDelete: Cascade)

    @@unique([shootId, editorId])
    @@index([shootId])
    @@index([editorId])
}

// Necessary for Next auth
model Account {
    id                       String  @id @default(cuid())
    userId                   String
    type                     String
    provider                 String
    providerAccountId        String
    refresh_token            String? // @db.Text
    access_token             String? // @db.Text
    expires_at               Int?
    token_type               String?
    scope                    String?
    id_token                 String? // @db.Text
    session_state            String?
    user                     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
    refresh_token_expires_in Int?

    @@unique([provider, providerAccountId])
}

model Session {
    id           String   @id @default(cuid())
    sessionToken String   @unique
    userId       String
    expires      DateTime
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
    id            String    @id @default(cuid())
    name          String?
    email         String?   @unique
    emailVerified DateTime?
    image         String?
    password      String?   // For email/password authentication
    role          String    @default("admin") // For future RBAC implementation
    accounts      Account[]
    sessions      Session[]
}

model Coupon {
    id          String   @id @default(cuid())
    code        String   @unique
    description String?
    type        String   // "percentage" or "fixed"
    value       Float    // Percentage (0-100) or fixed amount
    minAmount   Float?   // Minimum order amount
    maxUses     Int?     // Maximum number of uses (null = unlimited)
    usedCount   Int      @default(0)
    validFrom   DateTime
    validUntil  DateTime?
    isActive    Boolean  @default(true)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    @@index([code])
    @@index([isActive])
    @@index([validFrom])
    @@index([validUntil])
}

model VerificationToken {
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}
